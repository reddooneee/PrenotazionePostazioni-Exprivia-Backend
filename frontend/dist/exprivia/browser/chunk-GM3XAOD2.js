import{a as $e,b as Ue}from"./chunk-FZYR36Q4.js";import{b as Oe,c as Ae,d as Ne}from"./chunk-HYC2QBNA.js";import{A as Te,B as Ie,C as ke,D as Ee,E as Fe,F as Me,o as Se,p as $,r as xe,s as ye,w as De,x as Pe,y as Ce,z as we}from"./chunk-MUYZMUET.js";import{b as ze}from"./chunk-SI2F5UYO.js";import{a as Ve,b as Le}from"./chunk-FM2UL4ME.js";import{Ab as oe,Da as v,Db as _e,Ga as le,H as w,Ha as m,Ja as E,L as G,La as ie,Nb as ve,O as M,Ob as Y,Pa as r,Pb as be,Qa as a,Ra as y,Sa as A,Ta as N,Tb as j,V as T,Va as F,W as I,Wb as Z,Xa as P,Ya as h,a as U,aa as te,b as R,fb as ne,g as re,gb as d,hb as q,ib as S,j as O,jb as V,lb as de,mb as ce,mc as J,n as B,nb as me,pb as pe,qa as s,qb as ue,r as se,sb as L,tb as ge,ua as k,vb as fe,za as H,zb as he}from"./chunk-CEITJAHH.js";function qe(o,t){if(o&1){let e=F();r(0,"div",15),P("click",function(){let n=T(e).$implicit,l=h();return I(l.onDateClick(n))})("keydown.enter",function(){let n=T(e).$implicit,l=h();return I(l.onDateClick(n))})("keydown.space",function(){let n=T(e).$implicit,l=h();return I(l.onDateClick(n))}),r(1,"div",16)(2,"span",17),d(3),a()()()}if(o&2){let e=t.$implicit;E("bg-white",!e.isToday)("bg-blue-50",e.isToday)("ring-2",e.isToday)("ring-blue-500",e.isToday)("bg-blue-100",e.isSelected)("ring-2",e.isSelected)("ring-blue-600",e.isSelected)("bg-red-50",e.isWeekend)("text-red-600",e.isWeekend)("cursor-pointer",!e.isDisabled&&!e.isWeekend)("hover:bg-gray-50",!e.isDisabled&&!e.isWeekend)("hover:scale-105",!e.isDisabled&&!e.isWeekend)("hover:shadow-md",!e.isDisabled&&!e.isWeekend)("hover:z-10",!e.isDisabled&&!e.isWeekend)("disabled",e.isDisabled),le("aria-selected",e.isSelected)("aria-disabled",e.isDisabled||e.isWeekend),s(3),q(e.date.getDate())}}var Q=class o{constructor(t){this.cdr=t;this.updateDays()}set selectedDates(t){this._selectedDates=t?[...t]:[],this.updateDays(),this.cdr.markForCheck()}get selectedDates(){return this._selectedDates}disabledDates=[];dateTooltips=new Map;dateSelectionChange=new te;monthChange=new te;currentDate=new Date;weekDays=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"];_days=[];_selectedDates=[];get currentMonth(){return this.currentDate.getMonth()}get currentYear(){return this.currentDate.getFullYear()}getMonthName(){return this.currentDate.toLocaleString("it-IT",{month:"long"})}isCurrentMonth(){let t=new Date;return this.currentDate.getMonth()===t.getMonth()&&this.currentDate.getFullYear()===t.getFullYear()}previousPeriod(){this.isCurrentMonth()||(this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,1),this.updateDays(),this.monthChange.emit(this.currentDate))}nextPeriod(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,1),this.updateDays(),this.monthChange.emit(this.currentDate)}getDays(){return this._days}updateDays(){let t=[],e=new Date(this.currentYear,this.currentMonth,1),i=new Date(this.currentYear,this.currentMonth+1,0),n=new Date;n.setHours(0,0,0,0);let l=e.getDay()||7;if(l>1){let c=new Date(this.currentYear,this.currentMonth,0);for(let g=l-1;g>0;g--){let _=new Date(this.currentYear,this.currentMonth-1,c.getDate()-g+1);t.push(this.createCalendarDay(_,n))}}for(let c=1;c<=i.getDate();c++){let g=new Date(this.currentYear,this.currentMonth,c);t.push(this.createCalendarDay(g,n))}let p=i.getDay()||7;if(p<7)for(let c=1;c<=7-p;c++){let g=new Date(this.currentYear,this.currentMonth+1,c);t.push(this.createCalendarDay(g,n))}this._days=t,this.cdr.markForCheck()}createCalendarDay(t,e){let i=t<e,n=t.getDay()===0||t.getDay()===6,l=i||n;return{date:t,isToday:this.isSameDay(t,e),isWeekend:n,isSelected:this.isDateSelected(t),isDisabled:l}}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}isDateSelected(t){return this._selectedDates.some(e=>this.isSameDay(e,t))}onDateClick(t){if(t.isDisabled||t.isWeekend)return;let e=this.isDateSelected(t.date)?this._selectedDates.filter(i=>!this.isSameDay(i,t.date)):[t.date];this._selectedDates=[...e],this.updateDays(),this.cdr.detectChanges(),this.dateSelectionChange.emit([...e])}getDateTooltip(t){let e=t.toISOString().split("T")[0];return this.dateTooltips.get(e)||""}static \u0275fac=function(e){return new(e||o)(k(_e))};static \u0275cmp=H({type:o,selectors:[["app-calendar"]],inputs:{selectedDates:"selectedDates",disabledDates:"disabledDates",dateTooltips:"dateTooltips"},outputs:{dateSelectionChange:"dateSelectionChange",monthChange:"monthChange"},decls:28,vars:14,consts:[[1,"bg-white","rounded-xl","shadow-sm","p-4","sm:p-6"],[1,"flex","flex-col","sm:flex-row","justify-between","items-start","sm:items-center","gap-4","mb-6"],[1,"flex","items-center","space-x-2"],["id","calendar-title",1,"text-lg","sm:text-xl","font-semibold","min-w-[180px]"],[1,"flex","space-x-1"],["type","button","aria-label","Periodo precedente",1,"text-sm","p-2","rounded-lg","transition-colors","duration-200",3,"click","disabled"],[1,"fas","fa-chevron-left"],["type","button","aria-label","Periodo successivo",1,"text-sm","text-gray-500","hover:text-gray-900","transition-colors","duration-200","p-2","rounded-lg","hover:bg-gray-100",3,"click"],[1,"fas","fa-chevron-right"],[1,"calendar-container","w-full","max-w-4xl","mx-auto"],["role","row",1,"grid","grid-cols-7","mb-2","text-center","text-xs","sm:text-sm","font-medium"],["role","columnheader",1,"py-2"],["role","columnheader",1,"py-2","text-red-500"],["role","grid","aria-labelledby","calendar-title",1,"grid","grid-cols-7","gap-1","sm:gap-2","bg-gray-100","rounded-lg","p-2","sm:p-3"],["class","relative aspect-square flex flex-col items-center justify-center p-1 sm:p-2 rounded-lg transition-all duration-200","role","gridcell","tabindex","0",3,"bg-white","bg-blue-50","ring-2","ring-blue-500","bg-blue-100","ring-blue-600","bg-red-50","text-red-600","cursor-pointer","hover:bg-gray-50","hover:scale-105","hover:shadow-md","hover:z-10","disabled","click","keydown.enter","keydown.space",4,"ngFor","ngForOf"],["role","gridcell","tabindex","0",1,"relative","aspect-square","flex","flex-col","items-center","justify-center","p-1","sm:p-2","rounded-lg","transition-all","duration-200",3,"click","keydown.enter","keydown.space"],[1,"flex","flex-col","items-center"],[1,"text-xs","sm:text-sm","font-medium"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),d(4),a(),r(5,"div",4)(6,"button",5),P("click",function(){return i.previousPeriod()}),y(7,"i",6),a(),r(8,"button",7),P("click",function(){return i.nextPeriod()}),y(9,"i",8),a()()()(),r(10,"div",9)(11,"div",10)(12,"div",11),d(13,"Lun"),a(),r(14,"div",11),d(15,"Mar"),a(),r(16,"div",11),d(17,"Mer"),a(),r(18,"div",11),d(19,"Gio"),a(),r(20,"div",11),d(21,"Ven"),a(),r(22,"div",12),d(23,"Sab"),a(),r(24,"div",12),d(25,"Dom"),a()(),r(26,"div",13),v(27,qe,4,33,"div",14),a()()()),e&2&&(s(4),V(" ",i.getMonthName()," ",i.currentYear," "),s(2),E("text-gray-500",!i.isCurrentMonth())("hover:text-gray-900",!i.isCurrentMonth())("hover:bg-gray-100",!i.isCurrentMonth())("text-gray-300",i.isCurrentMonth())("cursor-not-allowed",i.isCurrentMonth()),m("disabled",i.isCurrentMonth()),s(21),m("ngForOf",i.getDays()))},dependencies:[Z,Y],styles:[".calendar[_ngcontent-%COMP%]{background:#fff;border-radius:.5rem;box-shadow:0 1px 3px #0000001a;padding:1rem;width:100%;max-width:400px}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.nav-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;padding:.5rem;color:#6b7280;transition:all .2s}.nav-button[_ngcontent-%COMP%]:not(:disabled):hover{color:#111827;background-color:#f3f4f6;border-radius:.375rem}.nav-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.weekdays[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:.5rem;margin-bottom:.5rem}.weekday[_ngcontent-%COMP%]{text-align:center;font-size:.875rem;color:#6b7280;font-weight:500}.days[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);gap:.5rem}.day[_ngcontent-%COMP%]{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:.375rem;font-size:.875rem;color:#374151;background-color:#fff;position:relative;border:2px solid transparent}.day[_ngcontent-%COMP%]:not(.disabled):not(.weekend){cursor:pointer;transition:all .2s}.day[_ngcontent-%COMP%]:not(.disabled):not(.weekend):hover{background-color:#f3f4f6;border-color:#d1d5db}.today[_ngcontent-%COMP%]{background-color:#eff6ff;color:#2563eb;font-weight:600}.weekend[_ngcontent-%COMP%]{color:#dc2626;cursor:not-allowed;background-color:#f3f4f6}.selected[_ngcontent-%COMP%]{background-color:#2563eb!important;color:#fff!important;border-color:#1d4ed8!important}.selected[_ngcontent-%COMP%]:hover{background-color:#1d4ed8!important}.disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#9ca3af;background-color:#f3f4f6;border:1px solid #E5E7EB;opacity:.6;pointer-events:none;transition:none}.disabled[_ngcontent-%COMP%]:hover{transform:none;box-shadow:none;background-color:#f3f4f6}.calendar-day[title][_ngcontent-%COMP%]{position:relative}.calendar-day[title][_ngcontent-%COMP%]:hover:after{content:attr(title);position:absolute;bottom:100%;left:50%;transform:translate(-50%);padding:.5rem;background-color:#1f2937;color:#fff;border-radius:.25rem;font-size:.875rem;white-space:nowrap;z-index:10}"],changeDetection:0})};var K=class o{constructor(t){this.axiosService=t}BASE_URL="/api/cose-durata";getAllCoseDurata(){return O(this.axiosService.get(this.BASE_URL))}getCosaDurataByNome(t){return O(this.axiosService.get(`${this.BASE_URL}/${t}`))}createCosaDurata(t){return O(this.axiosService.post(this.BASE_URL,t))}updateCosaDurata(t,e){return O(this.axiosService.put(`${this.BASE_URL}/${t}`,e))}deleteCosaDurata(t){return O(this.axiosService.delete(`${this.BASE_URL}/${t}`))}getCoseDurataByPrenotazione(t){return O(this.axiosService.get(`${this.BASE_URL}/prenotazione/${t}`))}static \u0275fac=function(e){return new(e||o)(M(J))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var X=class o{constructor(t,e,i,n,l){this.axiosService=t;this.stanzaService=e;this.postazioneService=i;this.cosaDurataService=n;this.prenotazioneService=l}ORARI_LAVORATIVI={INIZIO:8,FINE:18};getStanzeWithPostazioni(){return this.stanzaService.getStanzeWithPostazioni().pipe(B(t=>({stanze:t})))}getUserPrenotazioni(){return this.prenotazioneService.getMiePrenotazioni()}getPostazioniByStanza(t,e){let i=e.find(n=>n.id_stanza===t);return i?i.postazioni.filter(n=>n.id_postazione&&n.nomePostazione).map(n=>({id_postazione:n.id_postazione,nomePostazione:n.nomePostazione,stanza_id:t,stanza_nome:i.nome,tipo_stanza:i.tipo_stanza})):[]}getAvailableTimeSlots(t,e){let i=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),p=`${i}-${n}-${l}`;return console.log("DEBUG: Request parameters:",{formattedDate:p,postazioneId:e,originalDate:t,dateISOString:t.toISOString(),dateLocaleString:t.toLocaleString(),year:i,month:n,day:l}),this.prenotazioneService.getPrenotazioniByDayAndPostazione(p,e).pipe(B(c=>{if(console.log("Raw prenotazioni from backend:",JSON.stringify(c,null,2)),!c||c.length===0)return console.log("No prenotazioni found, returning all available slots"),this.generateTimeSlots([]);let g=c.filter(u=>u.stato_prenotazione!=="Annullata");if(console.log("Active prenotazioni (excluding cancelled):",{total:c.length,active:g.length,cancelled:c.length-g.length}),g.length===0)return console.log("No active prenotazioni found, returning all available slots"),this.generateTimeSlots([]);let _=g.map(u=>{console.log("Processing prenotazione:",{id:u.id_prenotazioni,raw_data_inizio:u.data_inizio,raw_data_fine:u.data_fine});let f;if(typeof u.data_inizio=="string"){let C=u.data_inizio.replace(" ","T");if(f=new Date(C),isNaN(f.getTime())){let x=C.split(/[-T:]/);x.length>=5&&(f=new Date(parseInt(x[0]),parseInt(x[1])-1,parseInt(x[2]),parseInt(x[3]),parseInt(x[4])))}}else Array.isArray(u.data_inizio)?f=new Date(u.data_inizio[0],u.data_inizio[1]-1,u.data_inizio[2],u.data_inizio[3]||0,u.data_inizio[4]||0):f=new Date(u.data_inizio);let b;if(typeof u.data_fine=="string"){let C=u.data_fine.replace(" ","T");if(b=new Date(C),isNaN(b.getTime())){let x=C.split(/[-T:]/);x.length>=5&&(b=new Date(parseInt(x[0]),parseInt(x[1])-1,parseInt(x[2]),parseInt(x[3]),parseInt(x[4])))}}else Array.isArray(u.data_fine)?b=new Date(u.data_fine[0],u.data_fine[1]-1,u.data_fine[2],u.data_fine[3]||0,u.data_fine[4]||0):b=new Date(u.data_fine);console.log("Parsed dates:",{startDate:f,endDate:b,startDateValid:!isNaN(f.getTime()),endDateValid:!isNaN(b.getTime())});let D=f.getHours(),z=b.getHours();return console.log("Extracted hours:",{startHour:D,endHour:z,isValidStart:!isNaN(D),isValidEnd:!isNaN(z)}),isNaN(D)||isNaN(z)?(console.warn("Invalid hours detected, skipping slot"),null):{start:D,end:z}}).filter(u=>u!==null);return console.log("Processed occupied slots:",_),this.generateTimeSlots(_)}))}getFileByPrenotazioni(t){return this.prenotazioneService.exportPrenotazioniDaily(t)}createPrenotazione(t){return this.prenotazioneService.createPrenotazione(t).pipe(B(()=>{}))}createPrenotazioneAdmin(t){return this.prenotazioneService.createPrenotazioneAdmin(t).pipe(B(()=>{}))}generateTimeSlots(t){let e=[],i=this.ORARI_LAVORATIVI.INIZIO,n=this.ORARI_LAVORATIVI.FINE,l=[600,240,120,60,30];function p(u,f,b,D){return u<D&&f>b}function c(u){return Math.floor(u)*60+(u%1===.5?30:0)}function g(u,f){let b=c(u),D=c(f);return!t.some(z=>{let C=c(z.start),x=c(z.end);return p(b,D,C,x)})}for(let u of l){let f=u>=60?60:30;for(let b=i;b<n;b+=f/60){let D=b,z=b+u/60;if(!(z>n)&&g(D,z)){let C=`${Math.floor(D).toString().padStart(2,"0")}:${D%1===.5?"30":"00"}`,x=`${Math.floor(z).toString().padStart(2,"0")}:${z%1===.5?"30":"00"}`;e.some(W=>W.startTime===C&&W.endTime===x)||e.push({startTime:C,endTime:x})}}}if(g(i,n)){let u={startTime:"08:00",endTime:"18:00"};e.some(f=>f.startTime===u.startTime&&f.endTime===u.endTime)||e.push(u)}return e.sort((u,f)=>{let b=c(parseInt(f.endTime.split(":")[0])+parseInt(f.endTime.split(":")[1])/60)-c(parseInt(u.startTime.split(":")[0])+parseInt(u.startTime.split(":")[1])/60),D=c(parseInt(f.endTime.split(":")[0])+parseInt(f.endTime.split(":")[1])/60)-c(parseInt(f.startTime.split(":")[0])+parseInt(f.startTime.split(":")[1])/60);return b!==D?D-b:u.startTime.localeCompare(f.startTime)}),console.log("Generated slots:",{total:e.length,slots:e,occupiedSlots:t}),e}isValidTimeSlot(t){let e=parseInt(t.split(":")[0]);return e>=this.ORARI_LAVORATIVI.INIZIO&&e<this.ORARI_LAVORATIVI.FINE}isWorkingDay(t){let e=t.getDay();return e!==0&&e!==6}getPrenotazioneInfo(){return se({stanze:this.stanzaService.getStanzeWithPostazioni(),coseDurata:this.cosaDurataService.getAllCoseDurata()})}getPrenotazioni(){return this.prenotazioneService.getPrenotazioni()}getMiePrenotazioni(){return this.prenotazioneService.getMiePrenotazioni()}deletePrenotazione(t){return this.prenotazioneService.deletePrenotazione(t)}updatePrenotazione(t,e){return this.prenotazioneService.updatePrenotazione(t,e)}static \u0275fac=function(e){return new(e||o)(M(J),M(Ue),M($e),M(K),M(Le))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var ee=(o,t)=>({"bg-blue-600":o,"bg-gray-300":t}),Qe=()=>({standalone:!0}),Ke=(o,t)=>({"bg-blue-600 text-white":o,"bg-white text-gray-700 border border-gray-300":t}),Xe=(o,t,e)=>({"bg-green-100 text-green-800":o,"bg-yellow-100 text-yellow-800":t,"bg-red-100 text-red-800":e}),et=(o,t)=>({"text-red-700 bg-red-100 hover:bg-red-200 focus:ring-red-500":o,"text-gray-500 bg-gray-100 cursor-not-allowed":t});function tt(o,t){o&1&&(r(0,"div",46),d(1," Seleziona una data dal calendario "),a())}function it(o,t){if(o&1&&(r(0,"div",47)(1,"span"),d(2),fe(3,"date"),a()()),o&2){let e=h();s(2),q(he(3,1,e.state.selectedDates[0],"EEEE d MMMM yyyy","","it"))}}function nt(o,t){if(o&1){let e=F();r(0,"button",60),P("click",function(){T(e);let n=h(2);return I(n.clearUserSearch())}),y(1,"i",61),a()}}function ot(o,t){if(o&1){let e=F();r(0,"div",64),P("click",function(){let n=T(e).$implicit,l=h(3);return I(l.selectUser(n))}),r(1,"div",65),d(2),a(),r(3,"div",7),d(4),a()()}if(o&2){let e=t.$implicit;s(2),V(" ",e.nome," ",e.cognome," "),s(2),S(" ",e.email," ")}}function at(o,t){if(o&1&&(r(0,"div",62),v(1,ot,5,3,"div",63),a()),o&2){let e=h(2);s(),m("ngForOf",e.filteredUsers)("ngForTrackBy",e.trackByUser)}}function rt(o,t){if(o&1&&(r(0,"div",66)(1,"div",67),d(2),a()()),o&2){let e=h(2);s(2),S(' Nessun utente trovato per "',e.userSearchTerm,'" ')}}function st(o,t){if(o&1&&(r(0,"div",68)(1,"div",69)(2,"span",70),d(3,"Prenotazione per:"),a(),r(4,"span",71),d(5),a()()()),o&2){let e=h(2);s(5),V("",e.selectedUser.nome," ",e.selectedUser.cognome,"")}}function lt(o,t){if(o&1){let e=F();r(0,"div",48)(1,"h4",14),y(2,"i",49),d(3," Seleziona utente (opzionale) "),a(),r(4,"div",50)(5,"input",51),me("ngModelChange",function(n){T(e);let l=h();return ce(l.userSearchTerm,n)||(l.userSearchTerm=n),I(n)}),P("ngModelChange",function(){T(e);let n=h();return I(n.filterUsers())})("focus",function(){T(e);let n=h();return I(n.showUserDropdown=!0)})("blur",function(){T(e);let n=h();return I(n.onUserInputBlur())}),a(),r(6,"div",52),v(7,nt,2,0,"button",53),y(8,"i",54),a()(),v(9,at,2,2,"div",55)(10,rt,3,1,"div",56)(11,st,6,2,"div",57),r(12,"div",58),y(13,"i",59),d(14," Se non selezioni un utente, la prenotazione sar\xE0 effettuata a tuo nome "),a()()}if(o&2){let e=h();s(5),de("ngModel",e.userSearchTerm),m("ngModelOptions",ue(6,Qe)),s(2),m("ngIf",e.userSearchTerm),s(2),m("ngIf",e.showUserDropdown&&e.filteredUsers.length>0),s(),m("ngIf",e.showUserDropdown&&e.userSearchTerm&&e.filteredUsers.length===0),s(),m("ngIf",e.selectedUser)}}function dt(o,t){if(o&1&&(r(0,"option",72),d(1),a()),o&2){let e=t.$implicit;m("value",e),s(),S(" ",e," ")}}function ct(o,t){o&1&&(r(0,"div",73),y(1,"i",59),d(2," Seleziona prima il tipo di stanza "),a())}function mt(o,t){if(o&1&&(r(0,"option",72),d(1),a()),o&2){let e=t.$implicit;m("value",e.id_postazione),s(),V(" ",e.nomePostazione," - ",e.stanza_nome," ")}}function pt(o,t){if(o&1&&(r(0,"div",74),y(1,"i",59),d(2),a()),o&2){let e,i=h();s(2),S(" Postazione selezionata nella stanza: ",i.getStanzaName((e=i.bookingForm.get("id_stanza"))==null?null:e.value)," ")}}function ut(o,t){if(o&1&&(r(0,"option",72),d(1),a()),o&2){let e=t.$implicit;m("value",e),s(),S(" ",e==="Giornata Intera"?"Giornata Intera":e==="4h"?"4 ore":e==="2h"?"2 ore":e==="1h"?"1 ora":e==="30m"?"30 minuti":e," ")}}function gt(o,t){if(o&1&&(r(0,"div",78)(1,"label",79),d(2,"Tipo di fascia oraria"),a(),r(3,"select",80)(4,"option",23),d(5,"Seleziona durata"),a(),v(6,ut,2,2,"option",24),a()()),o&2){let e=h(2);s(6),m("ngForOf",e.availableDurations)}}function ft(o,t){o&1&&(r(0,"div",81),d(1," Nessuna fascia oraria disponibile per questa postazione e data. "),a())}function ht(o,t){o&1&&(r(0,"div",73),y(1,"i",59),d(2," Seleziona una data dal calendario per vedere gli orari disponibili "),a())}function _t(o,t){o&1&&(r(0,"div",85),d(1," Giornata Intera disponibile. "),a())}function vt(o,t){o&1&&(A(0),d(1," Giornata intera non disponibile. \xC8 troppo tardi per prenotare l'intera giornata. "),N())}function bt(o,t){o&1&&(A(0),d(1," Nessuna giornata intera disponibile per questa postazione e data. "),N())}function zt(o,t){if(o&1&&(r(0,"div",86),v(1,vt,2,0,"ng-container",77)(2,bt,2,0,"ng-container",77),a()),o&2){let e=h(4);s(),m("ngIf",e.isTodaySelected()),s(),m("ngIf",!e.isTodaySelected())}}function St(o,t){if(o&1&&(A(0),v(1,_t,2,0,"div",83)(2,zt,3,2,"div",84),N()),o&2){let e=h(3);s(),m("ngIf",e.isFullDayAvailable()),s(),m("ngIf",!e.isFullDayAvailable())}}function xt(o,t){if(o&1){let e=F();r(0,"button",89),P("click",function(){let n,l=T(e).$implicit,p=h(5);return I((n=p.bookingForm.get("timeSlot"))==null?null:n.setValue(l.startTime+" - "+l.endTime))}),d(1),a()}if(o&2){let e,i=t.$implicit,n=h(5);m("ngClass",L(2,Ke,((e=n.bookingForm.get("timeSlot"))==null?null:e.value)===i.startTime+" - "+i.endTime,((e=n.bookingForm.get("timeSlot"))==null?null:e.value)!==i.startTime+" - "+i.endTime)),s(),S(" ",i.startTime+" - "+i.endTime," ")}}function yt(o,t){if(o&1&&(A(0),r(1,"div",87),v(2,xt,2,5,"button",88),a(),N()),o&2){let e=h(4);s(2),m("ngForOf",e.getFilteredTimeSlots())}}function Dt(o,t){o&1&&(A(0),d(1," Nessuna fascia oraria disponibile per questa durata. Gli orari passati non sono prenotabili. "),N())}function Pt(o,t){o&1&&(A(0),d(1," Nessuna fascia oraria disponibile per questa durata. "),N())}function Ct(o,t){if(o&1&&(r(0,"div",90),v(1,Dt,2,0,"ng-container",77)(2,Pt,2,0,"ng-container",77),a()),o&2){let e=h(4);s(),m("ngIf",e.isTodaySelected()),s(),m("ngIf",!e.isTodaySelected())}}function wt(o,t){if(o&1&&v(0,yt,3,1,"ng-container",82)(1,Ct,3,2,"ng-template",null,1,oe),o&2){let e=ne(2),i=h(3);m("ngIf",i.state.availableTimeSlots.length>0)("ngIfElse",e)}}function Tt(o,t){if(o&1&&(r(0,"div"),v(1,St,3,2,"ng-container",82)(2,wt,3,2,"ng-template",null,0,oe),a()),o&2){let e,i=ne(3),n=h(2);s(),m("ngIf",((e=n.bookingForm.get("slotDuration"))==null?null:e.value)==="Giornata Intera"&&n.availableDurations.includes("Giornata Intera"))("ngIfElse",i)}}function It(o,t){if(o&1&&(r(0,"div",17)(1,"h4",14),d(2),a(),v(3,gt,7,1,"div",75)(4,ft,2,0,"div",76)(5,ht,3,0,"div",25)(6,Tt,4,2,"div",77),a()),o&2){let e,i,n=h();s(2),S("",n.isAdmin?"4":"3",". Seleziona l'orario"),s(),m("ngIf",n.availableDurations.length>0),s(),m("ngIf",n.availableDurations.length===0&&n.state.selectedDates.length>0),s(),m("ngIf",((e=n.bookingForm.get("id_postazione"))==null?null:e.value)&&n.state.availableTimeSlots.length===0&&n.state.selectedDates.length===0),s(),m("ngIf",((i=n.bookingForm.get("id_postazione"))==null?null:i.value)&&n.state.availableTimeSlots.length>0&&n.availableDurations.length>0)}}function kt(o,t){o&1&&(r(0,"div",17)(1,"h4",14),d(2,"4. Seleziona l'orario"),a(),r(3,"div",73),y(4,"i",59),d(5," Seleziona prima una postazione "),a()())}function Et(o,t){o&1&&(r(0,"span",91),y(1,"i",92),a())}function Ft(o,t){if(o&1&&(r(0,"div",93),d(1),a()),o&2){let e=h();ie(e.state.errorMessage.includes("successo")?"text-green-600":"text-red-600"),s(),S(" ",e.state.errorMessage," ")}}function Mt(o,t){o&1&&(r(0,"p"),d(1,"Compila tutti i campi obbligatori"),a())}function Ot(o,t){o&1&&(r(0,"p"),d(1,"Seleziona una data"),a())}function At(o,t){o&1&&(r(0,"p"),d(1,"Seleziona il tipo di stanza"),a())}function Nt(o,t){o&1&&(r(0,"p"),d(1,"Seleziona una postazione"),a())}function Vt(o,t){o&1&&(r(0,"p"),d(1,"Seleziona una fascia oraria"),a())}function Lt(o,t){if(o&1&&(r(0,"div",94),v(1,Mt,2,0,"p",77)(2,Ot,2,0,"p",77)(3,At,2,0,"p",77)(4,Nt,2,0,"p",77)(5,Vt,2,0,"p",77),a()),o&2){let e,i,n,l=h();s(),m("ngIf",!l.bookingForm.valid),s(),m("ngIf",l.state.selectedDates.length===0),s(),m("ngIf",!((e=l.bookingForm.get("tipo_stanza"))!=null&&e.value)),s(),m("ngIf",!((i=l.bookingForm.get("id_postazione"))!=null&&i.value)),s(),m("ngIf",!((n=l.bookingForm.get("timeSlot"))!=null&&n.value))}}function $t(o,t){o&1&&(r(0,"div",95),y(1,"div",96),a())}function Ut(o,t){if(o&1&&(r(0,"div",97),d(1),a()),o&2){let e=h();s(),S(" ",e.state.errorMessage," ")}}function Rt(o,t){if(o&1){let e=F();r(0,"tr",105)(1,"td",106),d(2),a(),r(3,"td",106),d(4),a(),r(5,"td",107)(6,"div",108)(7,"div",69)(8,"div",65),d(9),a(),r(10,"div",109),d(11),a()()()(),r(12,"td",107)(13,"div",69)(14,"div",65),d(15),a(),r(16,"div",109),d(17),a()()(),r(18,"td",107)(19,"div",69)(20,"div",65),d(21),a(),r(22,"div",109),d(23),a()()(),r(24,"td",107)(25,"span",110),d(26),a()(),r(27,"td",111)(28,"button",112),P("click",function(){let n=T(e).$implicit,l=h(2);return I(l.cancelPrenotazione(n))}),y(29,"i",113),d(30," Annulla "),a()()()}if(o&2){let e=t.$implicit,i=h(2);s(2),S(" ",i.formatDate(e.data_inizio,"dd/MM/yyyy")," "),s(2),S(" ",i.getFormattedTimeRange(e.data_inizio,e.data_fine)," "),s(5),V(" ",e.users.nome||"N/A"," ",e.users.cognome||""," "),s(2),S(" ",e.users.email||"N/A"," "),s(4),S(" ",e.stanze.nome," "),s(2),S(" ID: ",e.stanze.id_stanza," "),s(4),S(" ",e.postazione.nomePostazione," "),s(2),S(" ID: ",e.postazione.id_postazione," "),s(2),m("ngClass",ge(14,Xe,e.stato_prenotazione==="Confermata",e.stato_prenotazione==="InAttesa",e.stato_prenotazione==="Annullata")),s(),S(" ",e.stato_prenotazione," "),s(2),m("disabled",i.state.isLoading||!i.canCancelPrenotazione(e))("ngClass",L(18,et,i.canCancelPrenotazione(e),!i.canCancelPrenotazione(e)))("title",i.canCancelPrenotazione(e)?"Annulla prenotazione":e.stato_prenotazione==="Annullata"?"Prenotazione gi\xE0 annullata":"Prenotazione scaduta")}}function Bt(o,t){o&1&&(r(0,"tr")(1,"td",114)(2,"div",115),y(3,"i",116),r(4,"p"),d(5,"Nessuna prenotazione trovata"),a()()()())}function jt(o,t){if(o&1){let e=F();r(0,"div",98)(1,"table",99)(2,"thead",100)(3,"tr")(4,"th",101)(5,"button",102),P("click",function(){T(e);let n=h();return I(n.sortTable("data_inizio"))}),r(6,"span"),d(7,"Data"),a(),y(8,"i"),a()(),r(9,"th",101),d(10,"Orario"),a(),r(11,"th",101),d(12,"Utente"),a(),r(13,"th",101),d(14,"Stanza"),a(),r(15,"th",101),d(16,"Postazione"),a(),r(17,"th",101),d(18,"Stato"),a(),r(19,"th",101),d(20,"Azioni"),a()()(),r(21,"tbody",103),v(22,Rt,31,21,"tr",104)(23,Bt,6,0,"tr",77),a()()()}if(o&2){let e=h();s(5),E("text-blue-600",e.isSortedColumn("data_inizio")),s(3),ie(e.getSortIcon("data_inizio")),s(14),m("ngForOf",e.sortedPrenotazioni),s(),m("ngIf",!(e.sortedPrenotazioni!=null&&e.sortedPrenotazioni.length)&&!e.state.isLoading)}}var Re=class o{constructor(t,e,i,n,l,p){this.fb=t;this.authService=e;this.prenotazionePosizioneService=i;this.toastService=n;this.datePipe=l;this.adminService=p;this.bookingForm=this.fb.group({userId:[""],tipo_stanza:["",$.required],id_stanza:[null,$.required],id_postazione:["",$.required],slotDuration:["",$.required],timeSlot:["",$.required],selectedDate:[null,$.required],note:[""]})}bookingForm;state={stanze:[],postazioniDisponibili:[],selectedDates:[],availableTimeSlots:[],isLoading:!1,errorMessage:""};tipiStanza=[];prenotazioni=[];sortedPrenotazioni=[];coseDurata=[];destroy$=new re;sortColumn="data_inizio";sortDirection="desc";statusFilter="attive";isAdmin=!1;users=[];userSearchTerm="";filteredUsers=[];showUserDropdown=!1;selectedUser=null;durationMap={"Giornata Intera":600,"4h":240,"2h":120,"1h":60,"30m":30};get availableDurations(){if(!this.state.availableTimeSlots||this.state.availableTimeSlots.length===0)return[];let t=new Set,e=this.state.selectedDates[0],i=new Date,n=e&&this.isSameDay(e,i),l=this.state.availableTimeSlots;if(n){let p=i.getHours(),c=i.getMinutes(),g=p*60+c;l=this.state.availableTimeSlots.filter(_=>{let u=parseInt(_.startTime.split(":")[0]),f=parseInt(_.startTime.split(":")[1]);return u*60+f>g+30})}return l.some(p=>p.startTime==="08:00"&&p.endTime==="18:00")&&t.add("Giornata Intera"),l.forEach(p=>{let c=parseInt(p.startTime.split(":")[0])*60+parseInt(p.startTime.split(":")[1]);switch(parseInt(p.endTime.split(":")[0])*60+parseInt(p.endTime.split(":")[1])-c){case 240:t.add("4h");break;case 120:t.add("2h");break;case 60:t.add("1h");break;case 30:t.add("30m");break}}),Array.from(t)}ngOnInit(){this.checkUserRole(),this.loadPrenotazioneInfo(),this.setupFormSubscriptions(),this.loadMiePrenotazioni()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadPrenotazioneInfo(){this.state.isLoading=!0,this.prenotazionePosizioneService.getStanzeWithPostazioni().pipe(w(this.destroy$)).subscribe({next:t=>{this.state.stanze=t.stanze,this.tipiStanza=[...new Set(t.stanze.map(e=>e.tipo_stanza))].filter(Boolean),this.state.isLoading=!1},error:t=>{console.error("Errore nel caricamento delle informazioni:",t),this.state.errorMessage="Errore nel caricamento delle informazioni",this.showErrorToast("Errore di Caricamento","Impossibile caricare le informazioni delle stanze. Ricarica la pagina per riprovare."),this.state.isLoading=!1}})}setupFormSubscriptions(){console.log("Stato iniziale del form:",{formValues:this.bookingForm.value,formValid:this.bookingForm.valid,formTouched:this.bookingForm.touched,formDirty:this.bookingForm.dirty}),this.bookingForm.valueChanges.pipe(w(this.destroy$)).subscribe(t=>{console.log("Form aggiornato:",{values:t,valid:this.bookingForm.valid,touched:this.bookingForm.touched,dirty:this.bookingForm.dirty,errors:this.bookingForm.errors,controls:{tipo_stanza:{value:this.bookingForm.get("tipo_stanza")?.value,valid:this.bookingForm.get("tipo_stanza")?.valid,errors:this.bookingForm.get("tipo_stanza")?.errors},id_postazione:{value:this.bookingForm.get("id_postazione")?.value,valid:this.bookingForm.get("id_postazione")?.valid,errors:this.bookingForm.get("id_postazione")?.errors},timeSlot:{value:this.bookingForm.get("timeSlot")?.value,valid:this.bookingForm.get("timeSlot")?.valid,errors:this.bookingForm.get("timeSlot")?.errors}}})}),this.bookingForm.get("tipo_stanza")?.valueChanges.pipe(w(this.destroy$)).subscribe(t=>{if(console.log("Tipo stanza cambiato:",t),this.bookingForm.patchValue({id_stanza:null,id_postazione:"",timeSlot:""}),t){console.log("Stanze disponibili:",this.state.stanze);let e=this.state.stanze.filter(i=>i.tipo_stanza===t);console.log("Stanze filtrate per tipo:",e),this.state.postazioniDisponibili=e.flatMap(i=>(console.log("Elaborazione stanza:",i),i.postazioni.filter(n=>n.id_postazione!==void 0&&n.nomePostazione!==void 0).map(n=>({id_postazione:n.id_postazione,nomePostazione:n.nomePostazione,stanza_id:i.id_stanza,stanza_nome:i.nome,tipo_stanza:i.tipo_stanza})))),console.log("Postazioni disponibili aggiornate:",this.state.postazioniDisponibili)}else this.state.postazioniDisponibili=[]}),this.bookingForm.get("id_postazione")?.valueChanges.pipe(w(this.destroy$)).subscribe(t=>{if(console.log("DEBUG: Cambio postazione, nuovo id:",t),t){console.log("Cercando postazione tra:",this.state.postazioniDisponibili);let e=Number(t),i=this.state.postazioniDisponibili.find(n=>n.id_postazione===e);console.log("Postazione trovata:",i),i?(console.log("Aggiornamento id_stanza da",this.bookingForm.get("id_stanza")?.value,"a",i.stanza_id),this.bookingForm.patchValue({id_stanza:i.stanza_id},{emitEvent:!1}),this.state.selectedDates.length>0&&(console.log("DEBUG: Chiamo loadAvailableTimeSlots da valueChanges con",e),this.loadAvailableTimeSlots(e))):console.error("Postazione non trovata per id:",t)}else console.log("Reset id_stanza a null"),this.bookingForm.patchValue({id_stanza:null},{emitEvent:!1})}),this.bookingForm.get("slotDuration")?.valueChanges.pipe(w(this.destroy$)).subscribe(()=>{this.bookingForm.patchValue({timeSlot:""});let t=this.bookingForm.get("id_postazione")?.value;t&&this.state.selectedDates.length>0&&(console.log("DEBUG: Chiamo loadAvailableTimeSlots da slotDuration con",t),this.loadAvailableTimeSlots(Number(t)))})}loadAvailableTimeSlots(t){let e=Number(t);if(isNaN(e)||this.state.selectedDates.length===0){console.warn("ID postazione non valido o nessuna data selezionata:",t),this.state.isLoading=!1;return}let i=this.state.selectedDates[0],n=this.bookingForm.get("slotDuration")?.value;console.log("DEBUG: loadAvailableTimeSlots details:",{postazioneId:e,selectedDate:i,selectedDuration:n,formValues:this.bookingForm.value,availableDurations:this.availableDurations}),this.prenotazionePosizioneService.getAvailableTimeSlots(i,e).pipe(w(this.destroy$)).subscribe({next:l=>{this.state.availableTimeSlots=l,console.log("Available time slots:",l);let p=this.availableDurations;console.log("DEBUG: Updated available durations:",p),n&&!p.includes(n)&&(console.log("DEBUG: Selected duration not in available durations, resetting form"),this.bookingForm.patchValue({slotDuration:"",timeSlot:""}));let c=this.bookingForm.get("slotDuration")?.value;if(l.length>0&&(!c||!p.includes(c))){let g=p[0];g&&(console.log("DEBUG: Setting first available duration:",g),this.bookingForm.patchValue({slotDuration:g}))}if(n==="Giornata Intera"){let g=l.find(_=>_.startTime==="08:00"&&_.endTime==="18:00");this.bookingForm.get("timeSlot")?.setValue(g?"08:00 - 18:00":"")}this.state.isLoading=!1},error:l=>{console.error("Errore nel caricamento degli orari:",l),this.state.errorMessage="Errore nel caricamento degli orari disponibili",this.showErrorToast("Orari Non Disponibili","Impossibile caricare gli orari disponibili per questa postazione. Prova a selezionare un'altra postazione."),this.state.isLoading=!1}})}onDateSelectionChange(t){console.log("Date selezionate:",t);let e=t&&t.length>0?[t[0]]:[];if(this.state.selectedDates=[...e],this.bookingForm.patchValue({selectedDate:e.length>0?e[0]:null,timeSlot:"",slotDuration:""}),this.state.availableTimeSlots=[],e.length>0){let i=this.bookingForm.get("id_postazione")?.value;i&&(this.state.isLoading=!0,this.prenotazionePosizioneService.getAvailableTimeSlots(e[0],Number(i)).pipe(w(this.destroy$)).subscribe({next:n=>{if(this.state.availableTimeSlots=n,this.bookingForm.patchValue({selectedDate:e[0]}),n.length===0)this.showWarningToast("Data Non Disponibile","Nessun orario disponibile per questa data"),this.bookingForm.patchValue({timeSlot:"",slotDuration:""});else{let l=this.availableDurations;if(l.length>0){let p=this.bookingForm.get("slotDuration")?.value,c=l.includes(p)?p:l[0];this.bookingForm.patchValue({slotDuration:c});let g=this.getFilteredTimeSlots();if(g.length>0){let _=g[0];this.bookingForm.patchValue({timeSlot:`${_.startTime} - ${_.endTime}`})}}else this.bookingForm.patchValue({slotDuration:"",timeSlot:""})}this.state.isLoading=!1},error:n=>{console.error("Errore nel controllo della disponibilit\xE0:",n),this.showErrorToast("Errore","Impossibile verificare la disponibilit\xE0 per questa data"),this.state.selectedDates=e,this.state.availableTimeSlots=[],this.bookingForm.patchValue({selectedDate:e[0],timeSlot:"",slotDuration:""}),this.state.isLoading=!1}}))}else this.state.selectedDates=[],this.bookingForm.patchValue({selectedDate:null,timeSlot:"",slotDuration:""})}onSubmit(){if(this.bookingForm.valid){let t=this.bookingForm.value,e=t.selectedDate,i=t.timeSlot;if(!i){this.showErrorToast("Selezione Incompleta","Seleziona un orario per completare la prenotazione");return}this.state.isLoading=!0,this.showInfoToast("Elaborazione in corso","Stiamo creando la tua prenotazione...");try{let n=new Date(e),l=new Date(e),p,c,g,_;i==="08:00 - 18:00"||i==="Giornata Intera"?(p="08",c="00",g="18",_="00"):([p,c]=i.split(" - ")[0].split(":"),[g,_]=i.split(" - ")[1].split(":")),n.setHours(parseInt(p),parseInt(c),0,0),l.setHours(parseInt(g),parseInt(_),0,0);let u=z=>{let C=z.getFullYear(),x=String(z.getMonth()+1).padStart(2,"0"),W=String(z.getDate()).padStart(2,"0"),Be=String(z.getHours()).padStart(2,"0"),je=String(z.getMinutes()).padStart(2,"0"),We=String(z.getSeconds()).padStart(2,"0");return`${C}-${x}-${W} ${Be}:${je}:${We}`};console.log("Form Data:",{raw:t,selectedDate:e,selectedTimeSlot:i,startDateTime:n,endDateTime:l,formattedStart:u(n),formattedEnd:u(l)});let f={id_postazione:parseInt(t.id_postazione),id_stanza:parseInt(t.id_stanza),data_inizio:u(n),data_fine:u(l)};if(!f.id_postazione||!f.id_stanza)throw new Error("ID postazione o ID stanza non validi");if(!this.isValidDate(n)||!this.isValidDate(l))throw new Error("Date non valide");console.log("Sending reservation request:",f);let b=this.bookingForm.get("userId")?.value;(this.isAdmin&&b?this.prenotazionePosizioneService.createPrenotazioneAdmin(R(U({},f),{id_user:parseInt(b)})):this.prenotazionePosizioneService.createPrenotazione(f)).subscribe({next:z=>{console.log("Prenotazione creata:",z),this.clearAllToasts(),this.showSuccessToast("Prenotazione Confermata!",`La tua postazione \xE8 stata prenotata per ${this.formatDate(e,"dd/MM/yyyy")} dalle ${i==="08:00 - 18:00"?"Giornata Intera":i}`),this.resetForm(),this.loadMiePrenotazioni();let C=this.bookingForm.get("id_postazione")?.value;C&&this.state.selectedDates.length>0&&(console.log("DEBUG: Reloading time slots after booking"),this.loadAvailableTimeSlots(C)),this.state.isLoading=!1},error:z=>{console.error("Errore completo nella creazione della prenotazione:",z),this.clearAllToasts(),this.showErrorToast("Errore di Validazione",z instanceof Error?z.message:"I dati inseriti non sono validi. Controlla i campi e riprova."),this.state.isLoading=!1}})}catch(n){console.error("Errore nella preparazione della prenotazione:",n),this.clearAllToasts(),this.showErrorToast("Errore di Validazione",n instanceof Error?n.message:"I dati inseriti non sono validi. Controlla i campi e riprova."),this.state.isLoading=!1}}else{let t=[];this.bookingForm.valid||t.push("Compila tutti i campi richiesti"),this.state.selectedDates.length===0&&t.push("Seleziona una data"),this.bookingForm.get("timeSlot")?.value||t.push("Seleziona un orario"),this.showWarningToast("Campi Mancanti",t.join(", "))}}resetForm(){this.bookingForm.reset(),this.state.selectedDates=[],this.state.availableTimeSlots=[],this.state.errorMessage="",this.isAdmin&&this.clearUserSearch()}getStanzaName(t){if(!t)return"";let e=this.state.stanze.find(i=>i.id_stanza===t);return e?e.nome:""}isFormValid(){let t=this.bookingForm.controls,e=!!t.tipo_stanza.value,i=!!t.id_stanza.value,n=!!t.id_postazione.value,l=!!t.selectedDate.value||this.state.selectedDates.length>0,p=!!t.timeSlot.value,c=!!t.slotDuration.value;(!p||!c)&&console.log("Form validation issue:",{hasTimeSlot:p,hasSlotDuration:c,timeSlotValue:t.timeSlot.value,slotDurationValue:t.slotDuration.value,availableDurations:this.availableDurations,availableTimeSlots:this.state.availableTimeSlots.length});let g=e&&i&&n&&l&&p&&c,_=this.bookingForm.valid;return g&&_}loadAllPrenotazioni(){this.state.isLoading=!0,this.prenotazionePosizioneService.getUserPrenotazioni().pipe(w(this.destroy$)).subscribe({next:t=>{console.log("=== DETTAGLIO PRENOTAZIONI ==="),console.log("Numero totale prenotazioni:",t.length),t.forEach((e,i)=>{console.group(`Prenotazione #${i+1}`),console.log("ID:",e.id_prenotazioni),console.log("Data Inizio (raw):",e.data_inizio),console.log("Data Fine (raw):",e.data_fine),console.log("Stato:",e.stato_prenotazione),console.log("Utente:",{id:e.users?.id_user,email:e.users?.email,nome:e.users?.nome,cognome:e.users?.cognome}),console.log("Stanza:",{id:e.stanze?.id_stanza,nome:e.stanze?.nome}),console.log("Postazione:",{id:e.postazione?.id_postazione,nome:e.postazione?.nomePostazione}),console.groupEnd()}),this.prenotazioni=t.map(e=>R(U({},e),{data_inizio:this.parseDate(e.data_inizio),data_fine:this.parseDate(e.data_fine),stato_prenotazione:e.stato_prenotazione||"Confermata"})),this.state.isLoading=!1,console.log("=== PRENOTAZIONI DOPO PARSING ==="),console.log(JSON.stringify(this.prenotazioni,null,2))},error:t=>{console.error("Errore nel caricamento delle prenotazioni:",t),this.showErrorToast("Errore","Errore nel caricamento delle prenotazioni"),this.state.isLoading=!1}})}loadMiePrenotazioni(){this.state.isLoading=!0,this.prenotazionePosizioneService.getUserPrenotazioni().pipe(w(this.destroy$)).subscribe({next:t=>{console.group("Prenotazioni Utente"),console.log("Raw prenotazioni data:",t),this.prenotazioni=t.map(e=>R(U({},e),{data_inizio:this.parseDate(e.data_inizio),data_fine:this.parseDate(e.data_fine),stato_prenotazione:e.stato_prenotazione||"Confermata",users:{id_user:e.users?.id_user||0,nome:e.users?.nome||"N/A",cognome:e.users?.cognome||"N/A",email:e.users?.email||"N/A",enabled:e.users?.enabled||!1},postazione:{id_postazione:e.postazione?.id_postazione||0,nomePostazione:e.postazione?.nomePostazione||"N/A"},stanze:{id_stanza:e.stanze?.id_stanza||0,nome:e.stanze?.nome||"N/A",tipo_stanza:e.stanze?.tipo_stanza||"N/A"}})),console.log("Processed prenotazioni:",this.prenotazioni),console.groupEnd(),this.applySorting(),this.state.isLoading=!1},error:t=>{console.error("Errore nel caricamento delle prenotazioni:",t),this.showErrorToast("Errore","Errore nel caricamento delle prenotazioni"),this.state.isLoading=!1}})}parseDate(t){if(t instanceof Date)return console.log("Value is already a Date"),t;if(Array.isArray(t))try{let[e,i,n,l,p]=t;return new Date(e,i-1,n,l,p)}catch(e){return console.error("Error parsing array date:",e),new Date}if(typeof t=="string"){if(t.includes(","))try{let[e,i,n,l,p]=t.split(",").map(Number);return new Date(e,i-1,n,l,p)}catch(e){return console.error("Error parsing comma-separated date:",e),new Date}try{return new Date(t)}catch(e){return console.error("Error parsing ISO date:",e),new Date}}return console.error("Unknown date format:",t),new Date}isValidDate(t){return t instanceof Date&&!isNaN(t.getTime())}formatDate(t,e){return this.isValidDate(t)&&this.datePipe.transform(t,e,"","it-IT")||"Data non valida"}getFormattedTimeRange(t,e){if(!this.isValidDate(t)||!this.isValidDate(e))return"Orario non valido";let i=this.formatDate(t,"HH:mm"),n=this.formatDate(e,"HH:mm");return`${i} - ${n}`}isValidTimeSlot(){let t=this.bookingForm.get("timeSlot")?.value;return!!(t&&t.start&&t.end)}deletePrenotazione(t){if(!t.id_prenotazioni){this.showErrorToast("Errore di Sistema","Impossibile identificare la prenotazione da eliminare");return}let e=this.formatDate(t.data_inizio,"dd/MM/yyyy"),i=this.getFormattedTimeRange(t.data_inizio,t.data_fine),n=t.postazione?.nomePostazione||"N/A";confirm(`Sei sicuro di voler eliminare la prenotazione?

\u{1F4C5} Data: ${e}
\u23F0 Orario: ${i}
\u{1F4BA} Postazione: ${n}

Questa azione non pu\xF2 essere annullata.`)&&(this.state.isLoading=!0,this.showInfoToast("Eliminazione in corso","Stiamo cancellando la tua prenotazione..."),this.prenotazionePosizioneService.deletePrenotazione(t.id_prenotazioni).pipe(w(this.destroy$)).subscribe({next:()=>{this.clearAllToasts(),this.showSuccessToast("Prenotazione Cancellata",`La prenotazione del ${e} \xE8 stata eliminata con successo`),this.prenotazioni=this.prenotazioni.filter(p=>p.id_prenotazioni!==t.id_prenotazioni),this.applySorting(),this.state.isLoading=!1},error:p=>{console.error("Errore nell'eliminazione della prenotazione:",p),this.clearAllToasts();let c="Si \xE8 verificato un errore durante l'eliminazione della prenotazione";p.message?.includes("non trovata")?c="La prenotazione non \xE8 pi\xF9 disponibile o \xE8 gi\xE0 stata eliminata":p.message?.includes("non autorizzato")&&(c="Non hai i permessi per eliminare questa prenotazione"),this.showErrorToast("Errore nell'Eliminazione",c),this.state.isLoading=!1}}))}showSuccessToast(t,e){this.toastService.showSuccess(t,e)}showErrorToast(t,e){this.toastService.showError(t,e)}showInfoToast(t,e){this.toastService.showInfo(t,e)}showWarningToast(t,e){this.toastService.showWarning(t,e)}clearAllToasts(){this.toastService.clear()}sortTable(t){this.sortColumn===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.applySorting()}applySorting(){this.sortedPrenotazioni=this.filteredPrenotazioni.sort((t,e)=>{let i,n;switch(this.sortColumn){case"data_inizio":i=new Date(t.data_inizio),n=new Date(e.data_inizio);break;case"utente":i=`${t.users?.nome||""} ${t.users?.cognome||""}`.trim().toLowerCase(),n=`${e.users?.nome||""} ${e.users?.cognome||""}`.trim().toLowerCase();break;case"stanza":i=(t.stanze?.nome||"").toLowerCase(),n=(e.stanze?.nome||"").toLowerCase();break;case"postazione":i=(t.postazione?.nomePostazione||"").toLowerCase(),n=(e.postazione?.nomePostazione||"").toLowerCase();break;case"stato":i=t.stato_prenotazione?.toLowerCase()||"",n=e.stato_prenotazione?.toLowerCase()||"";break;default:return 0}return i<n?this.sortDirection==="asc"?-1:1:i>n?this.sortDirection==="asc"?1:-1:0})}getSortIcon(t){return this.sortColumn!==t?"fas fa-sort text-gray-400":this.sortDirection==="asc"?"fas fa-sort-up text-blue-600":"fas fa-sort-down text-blue-600"}isSortedColumn(t){return this.sortColumn===t}setStatusFilter(t){this.statusFilter=t,this.applySorting()}getStatusFilterCount(t){if(t==="tutti")return this.prenotazioni.length;let e=new Date;return this.prenotazioni.filter(i=>{switch(t){case"attive":return i.stato_prenotazione==="Confermata"&&i.data_fine>e;case"scadute":return i.data_fine<=e;case"annullate":return i.stato_prenotazione==="Annullata";default:return!0}}).length}get filteredPrenotazioni(){if(this.statusFilter==="tutti")return this.prenotazioni;let t=new Date;return this.prenotazioni.filter(e=>{switch(this.statusFilter){case"attive":return e.stato_prenotazione==="Confermata"&&e.data_fine>t;case"scadute":return e.data_fine<=t;case"annullate":return e.stato_prenotazione==="Annullata";default:return!0}})}isFullDayAvailable(){if(!!!this.state.availableTimeSlots.find(l=>l.startTime==="08:00"&&l.endTime==="18:00"))return!1;let e=this.state.selectedDates[0],i=new Date;if(e&&this.isSameDay(e,i)){let l=i.getHours(),p=i.getMinutes(),c=l*60+p;return 8*60>c+30}return!0}getFilteredTimeSlots(){let t=this.bookingForm.get("slotDuration")?.value;if(!t||!this.state.availableTimeSlots.length)return[];let e=this.state.selectedDates[0],i=new Date,n=e&&this.isSameDay(e,i),l=i.getHours(),p=i.getMinutes(),c=[];if(t==="Giornata Intera")c=this.state.availableTimeSlots.filter(g=>g.startTime==="08:00"&&g.endTime==="18:00");else{let g=this.durationMap[t];c=this.state.availableTimeSlots.filter(_=>{let u=parseInt(_.startTime.split(":")[0])*60+parseInt(_.startTime.split(":")[1]);return parseInt(_.endTime.split(":")[0])*60+parseInt(_.endTime.split(":")[1])-u===g})}if(n){let g=l*60+p;c=c.filter(_=>{let u=parseInt(_.startTime.split(":")[0]),f=parseInt(_.startTime.split(":")[1]);return u*60+f>g+30})}return c}onMonthChange(t){console.log("Month changed to:",t)}checkMonthAvailability(t){}checkCurrentMonthAvailability(){}checkDateAvailability(t){}checkSinglePostazioneAvailability(t,e,i){}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}isTodaySelected(){if(this.state.selectedDates.length===0)return!1;let t=this.state.selectedDates[0],e=new Date;return this.isSameDay(t,e)}checkUserRole(){this.authService.getIdentity().pipe(w(this.destroy$)).subscribe(t=>{this.isAdmin=t?.authorities?.includes("ROLE_ADMIN")||!1,this.isAdmin?(this.loadUsers(),this.bookingForm.get("userId")?.clearValidators()):this.bookingForm.get("userId")?.clearValidators(),this.bookingForm.get("userId")?.updateValueAndValidity()})}loadUsers(){this.isAdmin&&this.adminService.getAllUsers().pipe(w(this.destroy$)).subscribe({next:t=>{this.users=t,this.filteredUsers=t},error:t=>{console.error("Errore nel caricamento degli utenti:",t),this.showErrorToast("Errore","Impossibile caricare la lista degli utenti")}})}filterUsers(){if(!this.userSearchTerm){this.filteredUsers=this.users;return}let t=this.userSearchTerm.toLowerCase();this.filteredUsers=this.users.filter(e=>e.nome?.toLowerCase().includes(t)||e.cognome?.toLowerCase().includes(t)||e.email?.toLowerCase().includes(t)||`${e.nome} ${e.cognome}`.toLowerCase().includes(t))}selectUser(t){this.selectedUser=t,this.userSearchTerm=`${t.nome} ${t.cognome}`,this.bookingForm.patchValue({userId:t.id_user}),this.showUserDropdown=!1}clearUserSearch(){this.userSearchTerm="",this.selectedUser=null,this.bookingForm.patchValue({userId:""}),this.filteredUsers=this.users,this.showUserDropdown=!1}onUserInputBlur(){setTimeout(()=>{this.showUserDropdown=!1},200)}trackByUser(t,e){return e.id_user}canCancelPrenotazione(t){if(t.stato_prenotazione==="Annullata")return!1;let e=new Date;return!(new Date(t.data_fine)<=e)}cancelPrenotazione(t){if(!t.id_prenotazioni){this.showErrorToast("Errore di Sistema","Impossibile identificare la prenotazione da annullare");return}if(!this.canCancelPrenotazione(t)){this.showWarningToast("Azione non consentita","Questa prenotazione non pu\xF2 essere annullata");return}let e=this.formatDate(t.data_inizio,"dd/MM/yyyy"),i=this.getFormattedTimeRange(t.data_inizio,t.data_fine),n=t.postazione?.nomePostazione||"N/A";confirm(`Sei sicuro di voler annullare la prenotazione?

\u{1F4C5} Data: ${e}
\u23F0 Orario: ${i}
\u{1F4BA} Postazione: ${n}

La prenotazione verr\xE0 contrassegnata come annullata.`)&&(this.state.isLoading=!0,this.showInfoToast("Annullamento in corso","Stiamo annullando la tua prenotazione..."),this.prenotazionePosizioneService.updatePrenotazione(t.id_prenotazioni,{stato_prenotazione:"Annullata"}).pipe(w(this.destroy$)).subscribe({next:p=>{this.clearAllToasts(),this.showSuccessToast("Prenotazione Annullata",`La prenotazione del ${e} \xE8 stata annullata con successo`);let c=this.prenotazioni.findIndex(g=>g.id_prenotazioni===t.id_prenotazioni);c!==-1&&(this.prenotazioni[c]=R(U({},this.prenotazioni[c]),{stato_prenotazione:"Annullata"})),this.applySorting(),this.state.isLoading=!1},error:p=>{console.error("Errore nell'annullamento della prenotazione:",p),this.clearAllToasts();let c="Si \xE8 verificato un errore durante l'annullamento della prenotazione";p.message?.includes("non trovata")?c="La prenotazione non \xE8 pi\xF9 disponibile":p.message?.includes("non autorizzato")&&(c="Non hai i permessi per annullare questa prenotazione"),this.showErrorToast("Errore nell'Annullamento",c),this.state.isLoading=!1}}))}static \u0275fac=function(e){return new(e||o)(k(Ee),k(ze),k(X),k(Ne),k(j),k(Ve))};static \u0275cmp=H({type:o,selectors:[["app-prenotazione-posizione"]],features:[pe([j])],decls:71,vars:76,consts:[["showSlotButtons",""],["noSlotsMsg",""],[1,"max-w-7xl","mx-auto","p-4","sm:p-6"],[1,"bg-white","rounded-xl","shadow-sm","p-4","sm:p-6","mb-6"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-xl","font-semibold","text-gray-800"],[1,"flex","items-center","space-x-2"],[1,"text-sm","text-gray-500"],[1,"flex","space-x-1"],[1,"w-2","h-2","rounded-full",3,"ngClass"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"md:col-span-2"],[1,"bg-gray-50","rounded-lg","p-4"],[1,"text-sm","font-medium","text-gray-700","mb-3"],[3,"dateSelectionChange","monthChange","selectedDates"],[1,"flex","flex-col","gap-4"],[1,"p-4","bg-gray-50","rounded-lg"],[1,"flex","flex-col","gap-2","min-h-[48px]","max-h-[200px]"],["class","flex items-center justify-center h-full text-gray-400 text-sm",4,"ngIf"],["class","flex items-center text-sm text-gray-600 py-2 px-3 bg-white rounded-lg border border-gray-200 shadow-sm",4,"ngIf"],["class","p-4 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],["formControlName","tipo_stanza",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","text-sm text-gray-500 mb-2",4,"ngIf"],["formControlName","id_postazione",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"disabled"],["class","mt-2 text-sm text-gray-600",4,"ngIf"],["class","p-4 bg-gray-50 rounded-lg",4,"ngIf"],["type","submit",1,"w-full","bg-blue-600","text-white","py-2","px-4","rounded-lg","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","duration-200",3,"disabled"],["class","mr-2",4,"ngIf"],["class","p-4 bg-gray-50 rounded-lg text-sm",3,"class",4,"ngIf"],["class","p-4 bg-gray-50 rounded-lg text-sm text-gray-600",4,"ngIf"],[1,"bg-white","rounded-xl","shadow-sm","p-4","sm:p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-800"],[1,"flex","items-center","space-x-4"],[1,"px-3","py-1","text-sm","font-medium","rounded-full","transition-colors","duration-200","hover:bg-blue-500","hover:text-white",3,"click"],[1,"px-3","py-1","text-sm","font-medium","rounded-full","transition-colors","duration-200","hover:bg-green-500","hover:text-white",3,"click"],[1,"px-3","py-1","text-sm","font-medium","rounded-full","transition-colors","duration-200","hover:bg-orange-500","hover:text-white",3,"click"],[1,"px-3","py-1","text-sm","font-medium","rounded-full","transition-colors","duration-200","hover:bg-red-500","hover:text-white",3,"click"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-red-600 text-sm mb-4",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["id","toast-container",1,"fixed","top-4","right-4","z-50","space-y-2"],["position","top-right",3,"showTransitionOptions","hideTransitionOptions"],[1,"flex","items-center","justify-center","h-full","text-gray-400","text-sm"],[1,"flex","items-center","text-sm","text-gray-600","py-2","px-3","bg-white","rounded-lg","border","border-gray-200","shadow-sm"],[1,"p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"fas","fa-user-cog","text-blue-600","mr-2"],[1,"relative"],["type","text","placeholder","Cerca utente per nome, cognome o email... (lascia vuoto per prenotare per te stesso)",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","pr-10","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","focus","blur","ngModel","ngModelOptions"],[1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","flex","items-center","space-x-1"],["type","button","class","text-gray-400 hover:text-gray-600 focus:outline-none","title","Cancella ricerca",3,"click",4,"ngIf"],[1,"fas","fa-search","text-gray-400"],["class","absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto",4,"ngIf"],["class","absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg p-3",4,"ngIf"],["class","mt-2 p-2 bg-white rounded border border-blue-200",4,"ngIf"],[1,"mt-2","text-xs","text-gray-600"],[1,"fas","fa-info-circle","mr-1"],["type","button","title","Cancella ricerca",1,"text-gray-400","hover:text-gray-600","focus:outline-none",3,"click"],[1,"fas","fa-times","text-sm"],[1,"absolute","z-50","w-full","mt-1","bg-white","border","border-gray-300","rounded-lg","shadow-lg","max-h-60","overflow-y-auto"],["class","px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"px-3","py-2","hover:bg-blue-50","cursor-pointer","border-b","border-gray-100","last:border-b-0",3,"click"],[1,"font-medium","text-gray-900"],[1,"absolute","z-50","w-full","mt-1","bg-white","border","border-gray-300","rounded-lg","shadow-lg","p-3"],[1,"text-sm","text-gray-500","text-center"],[1,"mt-2","p-2","bg-white","rounded","border","border-blue-200"],[1,"text-sm"],[1,"text-gray-600"],[1,"font-medium","text-blue-800","ml-1"],[3,"value"],[1,"text-sm","text-gray-500","mb-2"],[1,"mt-2","text-sm","text-gray-600"],["class","mb-3",4,"ngIf"],["class","text-sm text-red-600 mb-2",4,"ngIf"],[4,"ngIf"],[1,"mb-3"],["for","slotDuration",1,"block","text-xs","font-medium","text-gray-600","mb-1"],["id","slotDuration","formControlName","slotDuration",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","duration-200"],[1,"text-sm","text-red-600","mb-2"],[4,"ngIf","ngIfElse"],["class","text-green-700 font-semibold",4,"ngIf"],["class","text-red-600",4,"ngIf"],[1,"text-green-700","font-semibold"],[1,"text-red-600"],[1,"grid","grid-cols-3","gap-2"],["type","button","class","px-2 py-1.5 text-xs rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 whitespace-nowrap",3,"ngClass","click",4,"ngFor","ngForOf"],["type","button",1,"px-2","py-1.5","text-xs","rounded-lg","transition-colors","duration-200","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","whitespace-nowrap",3,"click","ngClass"],[1,"text-sm","text-red-600","mt-2"],[1,"mr-2"],[1,"fas","fa-spinner","fa-spin"],[1,"p-4","bg-gray-50","rounded-lg","text-sm"],[1,"p-4","bg-gray-50","rounded-lg","text-sm","text-gray-600"],[1,"flex","justify-center","items-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"text-red-600","text-sm","mb-4"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-4","sm:px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],["type","button",1,"flex","items-center","space-x-1","hover:text-gray-700","focus:outline-none","transition-colors","duration-200",3,"click"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50 transition-colors duration-150",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50","transition-colors","duration-150"],[1,"px-4","sm:px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],[1,"px-4","sm:px-6","py-4","whitespace-nowrap"],[1,"flex","items-center"],[1,"text-gray-500"],[1,"px-2","py-1","inline-flex","text-xs","leading-5","font-semibold","rounded-full",3,"ngClass"],[1,"px-4","sm:px-6","py-4","whitespace-nowrap","text-sm","font-medium"],["type","button",1,"inline-flex","items-center","px-2.5","py-1.5","border","border-transparent","text-xs","font-medium","rounded","focus:outline-none","focus:ring-2","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","duration-200",3,"click","disabled","ngClass","title"],[1,"fas","fa-times","mr-1"],["colspan","7",1,"px-4","sm:px-6","py-8","text-center","text-sm","text-gray-500"],[1,"flex","flex-col","items-center","justify-center","space-y-2"],[1,"fas","fa-calendar-times","text-gray-400","text-2xl"]],template:function(e,i){if(e&1&&(r(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),d(4,"Nuova Prenotazione"),a(),r(5,"div",6)(6,"span",7),d(7,"Step"),a(),r(8,"div",8),y(9,"div",9)(10,"div",9)(11,"div",9)(12,"div",9),a()()(),r(13,"form",10),P("ngSubmit",function(){return i.onSubmit()}),r(14,"div",11)(15,"div",12)(16,"div",13)(17,"h4",14),d(18,"1. Seleziona la data"),a(),r(19,"app-calendar",15),P("dateSelectionChange",function(l){return i.onDateSelectionChange(l)})("monthChange",function(l){return i.onMonthChange(l)}),a()()(),r(20,"div",16)(21,"div",17)(22,"h4",14),d(23,"Data selezionata"),a(),r(24,"div",18),v(25,tt,2,0,"div",19)(26,it,4,6,"div",20),a()(),v(27,lt,15,7,"div",21),r(28,"div",17)(29,"h4",14),d(30),a(),r(31,"select",22)(32,"option",23),d(33,"Seleziona tipo stanza"),a(),v(34,dt,2,2,"option",24),a()(),r(35,"div",17)(36,"h4",14),d(37),a(),v(38,ct,3,0,"div",25),r(39,"select",26)(40,"option",23),d(41,"Seleziona postazione"),a(),v(42,mt,2,3,"option",24),a(),v(43,pt,3,1,"div",27),a(),v(44,It,7,5,"div",28)(45,kt,6,0,"div",28),r(46,"div",17)(47,"button",29),v(48,Et,2,0,"span",30),d(49),a()(),v(50,Ft,2,3,"div",31)(51,Lt,6,5,"div",32),a()()()(),r(52,"div",33)(53,"div",34)(54,"h3",35),d(55,"Le tue prenotazioni"),a(),r(56,"div",36)(57,"div",6)(58,"button",37),P("click",function(){return i.setStatusFilter("tutti")}),d(59),a(),r(60,"button",38),P("click",function(){return i.setStatusFilter("attive")}),d(61),a(),r(62,"button",39),P("click",function(){return i.setStatusFilter("scadute")}),d(63),a(),r(64,"button",40),P("click",function(){return i.setStatusFilter("annullate")}),d(65),a()()()(),v(66,$t,2,0,"div",41)(67,Ut,2,1,"div",42)(68,jt,24,6,"div",43),a()(),y(69,"div",44)(70,"p-toast",45)),e&2){let n,l,p,c,g,_,u,f;s(9),m("ngClass",L(64,ee,i.state.selectedDates.length>0,i.state.selectedDates.length===0)),s(),m("ngClass",L(67,ee,(n=i.bookingForm.get("tipo_stanza"))==null?null:n.value,!((n=i.bookingForm.get("tipo_stanza"))!=null&&n.value))),s(),m("ngClass",L(70,ee,(l=i.bookingForm.get("id_postazione"))==null?null:l.value,!((l=i.bookingForm.get("id_postazione"))!=null&&l.value))),s(),m("ngClass",L(73,ee,(p=i.bookingForm.get("timeSlot"))==null?null:p.value,!((p=i.bookingForm.get("timeSlot"))!=null&&p.value))),s(),m("formGroup",i.bookingForm),s(6),m("selectedDates",i.state.selectedDates),s(6),m("ngIf",i.state.selectedDates.length===0),s(),m("ngIf",i.state.selectedDates.length===1),s(),m("ngIf",i.isAdmin),s(3),S("",i.isAdmin?"2":"1",". Seleziona il tipo di stanza"),s(4),m("ngForOf",i.tipiStanza),s(3),S("",i.isAdmin?"3":"2",". Seleziona la postazione"),s(),m("ngIf",!((c=i.bookingForm.get("tipo_stanza"))!=null&&c.value)),s(),m("disabled",!((g=i.bookingForm.get("tipo_stanza"))!=null&&g.value)),s(3),m("ngForOf",i.state.postazioniDisponibili),s(),m("ngIf",(_=i.bookingForm.get("id_postazione"))==null?null:_.value),s(),m("ngIf",(u=i.bookingForm.get("id_postazione"))==null?null:u.value),s(),m("ngIf",!((f=i.bookingForm.get("id_postazione"))!=null&&f.value)),s(2),m("disabled",!i.isFormValid()||i.state.isLoading),s(),m("ngIf",i.state.isLoading),s(),S(" ",i.state.isLoading?"Prenotazione in corso...":"Prenota"," "),s(),m("ngIf",i.state.errorMessage),s(),m("ngIf",!i.isFormValid()),s(7),E("bg-blue-600",i.statusFilter==="tutti")("text-white",i.statusFilter==="tutti")("bg-gray-100",i.statusFilter!=="tutti")("text-gray-700",i.statusFilter!=="tutti"),s(),S(" Tutti (",i.getStatusFilterCount("tutti"),") "),s(),E("bg-green-600",i.statusFilter==="attive")("text-white",i.statusFilter==="attive")("bg-gray-100",i.statusFilter!=="attive")("text-gray-700",i.statusFilter!=="attive"),s(),S(" Attive (",i.getStatusFilterCount("attive"),") "),s(),E("bg-orange-600",i.statusFilter==="scadute")("text-white",i.statusFilter==="scadute")("bg-gray-100",i.statusFilter!=="scadute")("text-gray-700",i.statusFilter!=="scadute"),s(),S(" Scadute (",i.getStatusFilterCount("scadute"),") "),s(),E("bg-red-600",i.statusFilter==="annullate")("text-white",i.statusFilter==="annullate")("bg-gray-100",i.statusFilter!=="annullate")("text-gray-700",i.statusFilter!=="annullate"),s(),S(" Annullate (",i.getStatusFilterCount("annullate"),") "),s(),m("ngIf",i.state.isLoading),s(),m("ngIf",i.state.errorMessage&&!i.state.errorMessage.includes("successo")),s(),m("ngIf",!i.state.isLoading),s(2),m("showTransitionOptions","300ms ease-out")("hideTransitionOptions","250ms ease-in")}},dependencies:[Z,ve,Y,be,j,Me,Pe,Ie,ke,Se,Te,xe,ye,Ce,we,Fe,De,Q,Ae,Oe],styles:["[_nghost-%COMP%]     .p-toast{z-index:9999}[_nghost-%COMP%]     .p-toast .p-toast-message{margin:0 0 .5rem;box-shadow:0 10px 25px -5px #0000001a,0 10px 10px -5px #0000000a;border-radius:.75rem;border:none;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);animation:_ngcontent-%COMP%_slideInRight .3s ease-out;min-width:320px;max-width:420px;background:#fffffff2;transform-origin:right center}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-leave{animation:_ngcontent-%COMP%_slideOutRight .25s ease-in forwards!important;overflow:hidden!important}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-leave, [_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-leave *, [_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-leave *:before, [_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-leave *:after{transform:none!important;transition:none!important;animation:none!important}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-leave{animation:_ngcontent-%COMP%_slideOutRight .25s ease-in forwards!important}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-success{border-left:4px solid #10b981}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-success .p-toast-message-icon{color:#10b981;background:#dcfce7;border-radius:50%;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-error{border-left:4px solid #ef4444}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-error .p-toast-message-icon{color:#ef4444;background:#fee2e2;border-radius:50%;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-info{border-left:4px solid #3b82f6}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-info .p-toast-message-icon{color:#3b82f6;background:#dbeafe;border-radius:50%;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-warn{border-left:4px solid #f59e0b}[_nghost-%COMP%]     .p-toast .p-toast-message.p-toast-message-warn .p-toast-message-icon{color:#f59e0b;background:#fef3c7;border-radius:50%;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;margin-right:.75rem;flex-shrink:0}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-message-icon{margin-right:.75rem;flex-shrink:0}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-message-text{flex:1;min-width:0}@keyframes _ngcontent-%COMP%_slideInRight{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes _ngcontent-%COMP%_slideOutRight{0%{transform:translate(0);opacity:1}to{transform:translate(100%);opacity:0}}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-message-content{padding:1rem;border:none;border-radius:.75rem;background:transparent;display:flex;align-items:flex-start;gap:.75rem}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-summary{font-weight:500;color:#111827;font-size:.875rem;margin-bottom:.25rem;line-height:1.4}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-detail{color:#6b7280;font-size:.875rem;line-height:1.5;word-wrap:break-word}[_nghost-%COMP%]     .p-toast-top-right{top:1rem;right:1rem}[_nghost-%COMP%]     .p-toast .p-toast-message:hover{transform:translateY(-1px);transition:transform .2s ease}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-icon-close{color:#9ca3af;background:transparent;border:none;padding:.375rem;border-radius:.5rem;transition:all .2s ease}[_nghost-%COMP%]     .p-toast .p-toast-message .p-toast-icon-close:hover{color:#4b5563;background:#f3f4f6}"]})};export{Re as a};
