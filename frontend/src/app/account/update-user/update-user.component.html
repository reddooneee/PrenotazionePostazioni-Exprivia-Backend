<div class="min-h-screen flex items-center justify-center p-4 bg-gray-50">
  <div class="bg-white rounded-[var(--radius-2xl)] shadow-[var(--shadow-xl)] w-full max-w-3xl overflow-hidden">
    <!-- Header - Correzione icona utente -->
    <div class="bg-gradient-to-r from-[var(--color-expriviaOrange)] to-[var(--color-expriviaOrange400)] p-6 text-center">
      <div class="inline-flex items-center justify-center w-12 h-12 bg-white/20 backdrop-blur-sm rounded-full mb-3">
        <mat-icon class="text-white !w-6 !h-6" aria-hidden="true">account_circle</mat-icon>
      </div>
      <h1 class="text-2xl font-bold text-white">Aggiorna il tuo profilo</h1>
      <p class="text-sm text-white/90 mt-1">Gestisci le tue informazioni personali</p>
    </div>

    <!-- Contenuto principale -->
    <div class="p-6 sm:p-8">
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6" role="form" aria-label="Form di aggiornamento profilo">
        <!-- Sezione Informazioni Base -->
        <div class="space-y-5">
          <h2 class="text-lg font-semibold text-[var(--color-expriviaBlue)] flex items-center gap-2">
            <mat-icon aria-hidden="true">person</mat-icon>
            <span>Informazioni personali</span>
          </h2>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
            <!-- Nome -->
            <div [@slideUp]="{ value: '', params: { delay: '100ms' } }">
              <label class="block text-sm font-medium mb-1">Nome *</label>
              <div class="relative">
                <input formControlName="nome" 
                       class="w-full border border-gray-300 rounded-[var(--radius-lg)] px-3 py-2 focus:outline-none focus:border-[var(--color-expriviaOrange)] focus:ring-1 focus:ring-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                       placeholder="Il tuo nome"
                       aria-required="true"
                       [attr.aria-invalid]="userForm.get('nome')?.invalid"
                       [attr.aria-describedby]="userForm.get('nome')?.invalid ? 'nome-error' : null">
              </div>
              <div *ngIf="nomeInvalid" class="text-xs text-red-600 mt-1" id="nome-error" role="alert">
                {{ getNomeErrorMessage() }}
              </div>
            </div>

            <!-- Cognome -->
            <div [@slideUp]="{ value: '', params: { delay: '100ms' } }">
              <label class="block text-sm font-medium mb-1">Cognome *</label>
              <div class="relative">
                <input formControlName="cognome" 
                       class="w-full border border-gray-300 rounded-[var(--radius-lg)] px-3 py-2 focus:outline-none focus:border-[var(--color-expriviaOrange)] focus:ring-1 focus:ring-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                       placeholder="Il tuo cognome"
                       aria-required="true"
                       [attr.aria-invalid]="userForm.get('cognome')?.invalid"
                       [attr.aria-describedby]="userForm.get('cognome')?.invalid ? 'cognome-error' : null">
              </div>
              <div *ngIf="cognomeInvalid" class="text-xs text-red-600 mt-1" id="cognome-error" role="alert">
                {{ getCognomeErrorMessage() }}
              </div>
            </div>
          </div>

          <!-- Email -->
          <div [@slideUp]="{ value: '', params: { delay: '200ms' } }">
            <label class="block text-sm font-medium mb-1">Email *</label>
            <div class="relative">
              <input formControlName="email" type="email"
                     class="w-full border border-gray-300 rounded-[var(--radius-lg)] px-3 py-2 focus:outline-none focus:border-[var(--color-expriviaOrange)] focus:ring-1 focus:ring-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                     placeholder="nome.cognome@exprivia.com"
                     aria-required="true"
                     [attr.aria-invalid]="userForm.get('email')?.invalid"
                     [attr.aria-describedby]="userForm.get('email')?.invalid ? 'email-error' : null">
            </div>
            <div *ngIf="emailInvalid" class="text-xs text-red-600 mt-1" id="email-error" role="alert">
              {{ getEmailErrorMessage() }}
            </div>
          </div>
        </div>

        <!-- Sezione Password -->
        <div class="space-y-5 pt-6 border-t border-gray-100">
          <h2 class="text-lg font-semibold text-[var(--color-expriviaBlue)] flex items-center gap-2">
            <mat-icon aria-hidden="true">lock</mat-icon>
            <span>Sicurezza</span>
          </h2>

          <div class="space-y-4">
            <!-- Password Attuale -->
            <div [@slideUp]="{ value: '', params: { delay: '300ms' } }">
              <label class="block text-sm font-medium mb-1">Password attuale</label>
              <div class="relative">
                <input [type]="hideCurrentPwd ? 'password' : 'text'" formControlName="currentPassword"
                       class="w-full border border-gray-300 rounded-[var(--radius-lg)] px-3 py-2 focus:outline-none focus:border-[var(--color-expriviaOrange)] focus:ring-1 focus:ring-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                       placeholder="Inserisci per verificare"
                       aria-required="true"
                       [attr.aria-invalid]="userForm.get('currentPassword')?.invalid"
                       [attr.aria-describedby]="userForm.get('currentPassword')?.invalid ? 'current-password-error' : null">
                <button type="button" (click)="hideCurrentPwd = !hideCurrentPwd"
                        class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                        [attr.aria-label]="hideCurrentPwd ? 'Mostra password' : 'Nascondi password'">
                  <mat-icon class="w-5 h-5" aria-hidden="true">{{hideCurrentPwd ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>
              </div>
              <div *ngIf="currentPasswordInvalid" class="text-xs text-red-600 mt-1" id="current-password-error" role="alert">
                {{ getCurrentPasswordErrorMessage() }}
              </div>
            </div>

            <!-- Nuova Password -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div [@slideUp]="{ value: '', params: { delay: '300ms' } }">
                <label class="block text-sm font-medium mb-1">Nuova password</label>
                <div class="relative">
                  <input [type]="hideNewPwd ? 'password' : 'text'" formControlName="newPassword"
                         class="w-full border border-gray-300 rounded-[var(--radius-lg)] px-3 py-2 focus:outline-none focus:border-[var(--color-expriviaOrange)] focus:ring-1 focus:ring-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                         placeholder="inserisci la nuova password"
                         [attr.aria-invalid]="userForm.get('newPassword')?.invalid"
                         [attr.aria-describedby]="userForm.get('newPassword')?.invalid ? 'new-password-error' : null">
                  <button type="button" (click)="hideNewPwd = !hideNewPwd"
                          class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                          [attr.aria-label]="hideNewPwd ? 'Mostra password' : 'Nascondi password'">
                    <mat-icon class="w-5 h-5" aria-hidden="true">{{hideNewPwd ? 'visibility_off' : 'visibility'}}</mat-icon>
                  </button>
                </div>
                <div *ngIf="newPasswordInvalid" class="text-xs text-red-600 mt-1" id="new-password-error" role="alert">
                  {{ getNewPasswordErrorMessage() }}
                </div>
              </div>

              <div [@slideUp]="{ value: '', params: { delay: '300ms' } }">
                <label class="block text-sm font-medium mb-1">Conferma password</label>
                <div class="relative">
                  <input [type]="hideConfirmPwd ? 'password' : 'text'" formControlName="confirmPassword"
                         class="w-full border border-gray-300 rounded-[var(--radius-lg)] px-3 py-2 focus:outline-none focus:border-[var(--color-expriviaOrange)] focus:ring-1 focus:ring-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                         placeholder="conferma la nuova password"
                         [attr.aria-invalid]="userForm.get('confirmPassword')?.invalid"
                         [attr.aria-describedby]="userForm.get('confirmPassword')?.invalid ? 'confirm-password-error' : null">
                  <button type="button" (click)="hideConfirmPwd = !hideConfirmPwd"
                          class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-[var(--color-expriviaOrange)] transition-[var(--transition-colors)]"
                          [attr.aria-label]="hideConfirmPwd ? 'Mostra password' : 'Nascondi password'">
                    
                  </button>
                </div>
                <div *ngIf="confirmPasswordInvalid" class="text-xs text-red-600 mt-1" id="confirm-password-error" role="alert">
                  {{ getConfirmPasswordErrorMessage() }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Azioni -->
        <div class="flex flex-col-reverse sm:flex-row gap-4 pt-6">
          <button type="button" (click)="resetForm()"
                  class="w-full sm:w-auto px-5 py-2.5 border border-gray-300 text-gray-700 font-medium rounded-[var(--radius-lg)] hover:bg-gray-50 transition-[var(--transition-all)] flex items-center justify-center gap-2"
                  aria-label="Annulla modifiche">
            <mat-icon aria-hidden="true">close</mat-icon>
            <span>Annulla</span>
          </button>
          <button type="submit" [disabled]="userForm.invalid || isLoading"
                  class="w-full sm:w-auto px-5 py-2.5 bg-gradient-to-r from-[var(--color-expriviaOrange)] to-[var(--color-expriviaOrange400)] text-white font-medium rounded-[var(--radius-lg)] hover:shadow-[var(--shadow-md)] transition-[var(--transition-all)] disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2 relative overflow-hidden group"
                  aria-label="Salva modifiche" [attr.aria-busy]="isLoading">
            <div class="absolute inset-0 bg-gradient-to-r from-[var(--color-expriviaOrange400)] to-[var(--color-expriviaOrange)] opacity-0 group-hover:opacity-100 transition-[var(--transition-opacity)]"></div>
            <div class="relative flex items-center justify-center gap-2">
              <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2" aria-hidden="true"></mat-spinner>
              <mat-icon *ngIf="!isLoading" aria-hidden="true">save</mat-icon>
              <span class="group-hover:scale-105 transition-[var(--transition-transform)]">Salva modifiche</span>
            </div>
          </button>
        </div>

        <!-- Messaggi di stato -->
        <div *ngIf="errorMessage" [@shake]
             class="mt-5 p-3 text-sm text-red-600 bg-red-50 rounded-[var(--radius-lg)] flex items-start gap-2 border border-red-100"
             role="alert" aria-live="assertive">
          <mat-icon class="text-red-500 animate-pulse" aria-hidden="true">error</mat-icon>
          <span>{{ errorMessage }}</span>
        </div>

        <div *ngIf="updateSuccess" [@slideUp]="{ value: '', params: { delay: '100ms' } }"
             class="mt-5 p-3 text-sm text-green-600 bg-green-50 rounded-[var(--radius-lg)] flex items-start gap-2 border border-green-100"
             role="alert" aria-live="polite">
          <mat-icon class="text-green-500" aria-hidden="true">check_circle</mat-icon>
          <span>Profilo aggiornato con successo!</span>
        </div>
      </form>
    </div>
  </div>
</div>